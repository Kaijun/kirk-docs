# 2.2 服务在集群内/集群外的访问  


![](_figures/quick-start/cluster-app-netconfig.png)

***
## 2.2.1 集群内
容器在发生异常重启后，会出现内网IP的改变。这种情况下，如果还是通过IP+PORT的形式访问容器，会导致访问异常。因此集群内的服务访问，平台通过服务注册发现的机制来完成。

**操作如下：**    

1）填写监听的「容器端口」

2）选择容器的「通信协议」

?> 服务创建后会自动添加DNS记录，服务以 **<应用名>-<服务名>:<端口号>** 的形式暴露访问方式到集群内部。

![](_figures/quick-start/cluster-app-inside.png)
***
## 2.2.2 集群外
负载均衡可以扩展服务的访问能力到集群外部，平台支持「HTTP/HTTPS」七层和「TCP」四层两类负载均衡。
    
### HTTP/HTTPS七层负载均衡
七层负载均衡有两种方式挂载到服务：    
第一种是「创建服务」时，添加七层负载均衡到服务。    
第二种是先在「负载均衡」组件页面下创建七层负载均衡，再选择需要挂载的服务。    
这里以第一种为例，第二种[详见3.6](user-guide/loadbalance.md)

**操作如下:**    
1）首先「开启负载均衡」

2）点击「添加icon」，打开负载均衡快速创建页

?> **负载均衡名称：**长度为2-64的小写字母、数字或"-", 不能以"-"开头或结尾。<br>
   **描述：**负载均衡的文本描述。<br>
   **计费方式：**负载均衡的计费方式，当前仅支持按流量计费。<br>
   **域名：**为负载均衡绑定自定义域名，[详见3.7](user-guide/domain.md)。<br>

![](_figures/quick-start/cluster-app-7loadbalance-on.png)

![](_figures/quick-start/cluster-app-7loadbalance-on2.png)

   
3）点击「创建」，完成七层负载均衡的创建    

4）填写「路径」，将访问域名下的某个子目录指向服务。

### TCP四层负载均衡    

**操作如下：**    
1）点击左侧菜单栏「负载均衡」，进入负载均衡组件页面

2）点击「TCP」，切换到TCP四层负载均衡Tab

3）点击「添加负载均衡」，打开负载均衡快速创建页

?> **负载均衡名称：**长度为2-64的小写字母、数字或"-", 不能以"-"开头或结尾。<br>
   **描述：**负载均衡的文本描述。<br>
   **IP类型：**服务的IP访问方式，包括内网、电信、联通。其中内网用于支持集群内跨空间访问。<br>
   **计费方式：**按带宽计费。如果选择内网，则不计费。<br>
   **带宽限制：**限制负载均衡最大带宽。<br>
   **后端服务：**选择该负载均衡挂载到的服务名称。<br>
   **转发规则：**配置负载均衡的「监听端口」到服务的「后端端口」。<br>

![](_figures/quick-start/cluster-app-balance4-1.png) 
   
4）点击「创建」，完成四层负载均衡的创建    